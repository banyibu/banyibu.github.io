<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>NoSQL第十三章-NoSQL的实用辅助工具 | 致良知，事上练</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="概述通过测试发现性能特定及通过监控发现潜在的运行问题非常重要。这里以MongoDB、Redis数据库系统为基础，介绍一些测试工具和监控工具。">
<meta name="keywords" content="数据库,NoSQL">
<meta property="og:type" content="article">
<meta property="og:title" content="NoSQL第十三章-NoSQL的实用辅助工具">
<meta property="og:url" content="http://banyibu.com/2019/01/11/NoSQL第十三章-NoSQL的实用辅助工具/index.html">
<meta property="og:site_name" content="致良知，事上练">
<meta property="og:description" content="概述通过测试发现性能特定及通过监控发现潜在的运行问题非常重要。这里以MongoDB、Redis数据库系统为基础，介绍一些测试工具和监控工具。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-01-16T09:01:02.308Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NoSQL第十三章-NoSQL的实用辅助工具">
<meta name="twitter:description" content="概述通过测试发现性能特定及通过监控发现潜在的运行问题非常重要。这里以MongoDB、Redis数据库系统为基础，介绍一些测试工具和监控工具。">
  
    <link rel="alternate" href="/atom.xml" title="致良知，事上练" type="application/atom+xml">
  
  
    <link rel="icon" href="images/1260.gif">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://upload-images.jianshu.io/upload_images/12985001-ffd8bc90edb9f3e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    <h2 class="author">般一不</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>59</strong><br>文章</div></a>
      <a href="/categories"><div><strong>27</strong><br>分类</div></a>
      <a href="/tags"><div><strong>27</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
          <a href="/about" title="About">
            <li>关于</li>
          </a>
        
          <a href="/sponsor" title="Sponsor">
            <li>投喂</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-NoSQL第十三章-NoSQL的实用辅助工具" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/11/NoSQL第十三章-NoSQL的实用辅助工具/" class="article-date">
  <time class="post-time" datetime="2019-01-11T12:08:59.000Z" itemprop="datePublished">
    <span class="post-month">1月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      NoSQL第十三章-NoSQL的实用辅助工具
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/计算机基础/">计算机基础</a>,<a class="article-category-link" href="/categories/计算机基础/数据库/">数据库</a>,<a class="article-category-link" href="/categories/计算机基础/数据库/NoSQL/">NoSQL</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>通过测试发现性能特定及通过监控发现潜在的运行问题非常重要。这里以MongoDB、Redis数据库系统为基础，介绍一些测试工具和监控工具。<br><a id="more"></a></p>
<h1 id="测试工具"><a href="#测试工具" class="headerlink" title="测试工具"></a>测试工具</h1><h2 id="YCSB测试工具"><a href="#YCSB测试工具" class="headerlink" title="YCSB测试工具"></a>YCSB测试工具</h2><h3 id="YCSB下载安装"><a href="#YCSB下载安装" class="headerlink" title="YCSB下载安装"></a>YCSB下载安装</h3><p>YCSB(Yahoo! Cloud Serving Benchmark)，主要测试数据库的并发量和延迟响应时间。<br>安装该测试工具，需要安装javaJDK、Python、Mvn、YCSB工具等。<br><a href="https://github.com/brianfrankcooper/YCSB/releases/tag/" target="_blank" rel="noopener">YCSB下载地址</a><br>YCSB安装后，需要用Python.exe执行YCSB脚本。<br>在cmd下，切换到YCSB安装目录下，执行<code>pythonw.exe ycsb run load basic -P workloads\workloada -s recordcount=4</code><br>上述测试执行了一次4个插入语句的负载压力测试，并给出测试结果的统计信息。<br>basic是一种虚设客户端，实际不操作任何数据库；<br>-P为指定传入命令相关参数；<br>参数workloads\workloada为加入负载文件，参数-s显示测试过程状态，参数recordcount=4为插入4条记录。<br>YCSB对数据库性能的测试主要分数据装入阶段和执行测试阶段两部分。</p>
<h3 id="测试Redis数据库"><a href="#测试Redis数据库" class="headerlink" title="测试Redis数据库"></a>测试Redis数据库</h3><p>此时Redis数据库之前必须保证Redis服务器端正在运行。<br><strong>步骤1：</strong>先用load装入对指定Redis数据库插入指定数量的数据记录：<br><code>ycsb load redis -s -P workloads/workloada -p &quot;redis.host=127.0.0.1&quot; -p &quot;redis.port=6379&quot; -p recordcount=40000</code><br>对指定数据库插入40000条数据；<br><strong>步骤2：</strong>用run测试读写操作：<br><code>ycsb run redis -s -P workloads/workloada -p &quot;redis.host=127.0.0.1&quot; -p &quot;redis.port=6379&quot; -threads 50 -p &quot;operationcount=10000&quot; -p &quot;measurementtype=timeseries&quot; -p &quot;timeseries.granularity=5000</code><br>threads 50 一次并发50线程；<br>operationcount=10000 指定并发量/秒(含读写)；<br>measurementtype=timeseries 指定测试结果用时间序列逐条显示，还可以设置histogram值(或hdrhistogram值)，以直方图的形式显示测试结果。</p>
<h3 id="测试MongoDB数据库"><a href="#测试MongoDB数据库" class="headerlink" title="测试MongoDB数据库"></a>测试MongoDB数据库</h3><p>需要对workload下任意一个文件进行测试参数设置，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mongodb.url=mongodb://loacalhost:40000</span><br><span class="line">mogondb.database=Datatest1	//待测试使用的数据库名称</span><br><span class="line">mongodb.writeConcern=normal	//写入安全性为常规</span><br><span class="line">recordcount=100000	//最初加载到数据库的记录数</span><br><span class="line">operationcount=100000	//要执行的操作次数</span><br><span class="line">workload=com.yahoo.ycsb.workloads.CoreWorkload	//workload实现类</span><br><span class="line">readallfields=true	//true为查询时读取所有字段</span><br><span class="line">readproportion=1	//应该读取什么比例的操作(默认值：0.95)</span><br><span class="line">updateproportion=1	//应该更新哪些比例的操作(默认值0.05)</span><br><span class="line">scanproportion=0	//应该扫描什么比例的操作(默认值：0)</span><br><span class="line">insertproportion=0	//应该插入什么比例的操作(默认值：0)</span><br><span class="line">requestdistribution=zipfian	//应该使用什么分配选择记录来操作-uniform，zipfian or latest</span><br><span class="line">threadcount=100	//并发线程数量</span><br><span class="line">fieldlength=200	//每个记录大小为128B？？？？？？？？？？</span><br><span class="line">fieldcount=8	//每个记录8个字段，一条记录大小为1KB</span><br><span class="line">table=testCollection	//指定集合名称，默认为usertable</span><br></pre></td></tr></table></figure></p>
<p>上述压力测试只做读操作。<br>在Windows命令操作符下执行数据库加载数据命令，并把结果输出到11.txt文件中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pythonw.exe ycsb load mongodb -P workloads/workloada&gt;11.txt</span><br></pre></td></tr></table></figure></p>
<h2 id="Redis-benchmark"><a href="#Redis-benchmark" class="headerlink" title="Redis-benchmark"></a>Redis-benchmark</h2><p>Redis-benchmark是Redis免费提供的自带数据库性能测试工具。<br>Redis-benchmark工具使用格式：<br><code>redis-benchmark [-h &lt;host&gt;] [-p &lt;port&gt;] [-c &lt;clients&gt;] [-n &lt;requests&gt;] [-k &lt;boolean&gt;]...</code></p>
<h3 id="使用参数"><a href="#使用参数" class="headerlink" title="使用参数"></a>使用参数</h3><p>Redis-benchmark参数内容设置：<br><code>-h &lt;hostname&gt;</code>,IP地址，默认为127.0.0.1；<br><code>-p &lt;port&gt;</code>,端口号，默认为6379；<br><code>-s &lt;socket&gt;</code>,数据库服务器Socket接口(可以代替-h,-t)；<br><code>-a &lt;password&gt;</code>,需要测试Redis的访问密码(覆盖已经设置)；<br><code>-c &lt;clients&gt;</code>,客户端并发连接数，默认最高50个连接访问；<br><code>-n &lt;requests&gt;</code>,测试命令请求总数，默认100000次；<br><code>-d &lt;size&gt;</code>,指定测试命令(读或写)一次发送的数据大小，默认2字节；<br><code>-dbnum &lt;db&gt;</code>,对Redis实例中指定数据库进行测试，默认是0号数据库；<br><code>-k &lt;boolean&gt;</code>,1=keep alive(测试中保持连接)，0=reconnect(测试时重新连接)，默认值为1；<br><code>-r &lt;keyspacelen&gt;</code>,在用SET/GET/INCR命令测试时，使用随机产生的Key对象。在用SADD命令测试时，使用随机产生的值；keyspacelen用于指定随机产生对象的数量，其范围是0到keyspacelen-1的整数，最多12位；<br><code>-P &lt;numreq&gt;</code>,用管道命令方式并发提交命令请求，默认值为1(表示不启用管道命令)，<code>&lt;numreq&gt;</code>为同时提交的命令请求数；<br><code>-q</code>,以后台模式运行该工具的测试过程，只显示查询/秒值；<br><code>-csv</code>,以CSV文件格式输出测试结果；<br><code>-l</code>,以循环方式，持续执行该工具的测试动作；<br><code>-t &lt;test&gt;</code>,仅运行以逗号分割的测试列表；<br><code>-I</code>,空闲模式，只打开N个空闲连接并等待；</p>
<h3 id="测试案例"><a href="#测试案例" class="headerlink" title="测试案例"></a>测试案例</h3><p>运行测试前，需要确保Redis实例运行。</p>
<h4 id="默认值测试"><a href="#默认值测试" class="headerlink" title="默认值测试"></a>默认值测试</h4><p><code>redis-benchmark -q</code><br>默认IP，默认端口，Redis实例的0号数据库；并以50个客户端访问，执行100000次读写命令的方式测试。</p>
<h4 id="指定命令范围测试"><a href="#指定命令范围测试" class="headerlink" title="指定命令范围测试"></a>指定命令范围测试</h4><p><code>redis-benchmark -t set, lpush -q</code><br>使用-t指定set、lpush命令，对当前数据库进行100000此写的测试。<br>也可以通过脚本进一步指定特定命令的测试执行过程。<br><code>redis-benchmark -n 1000000 -q script load &quot;redis.call(&#39;set&#39;,&#39;testStr&#39;,&#39;ABLUECAT!!&#39;)&quot;</code><br>上述对testStr字符串对象连续执行1000000次“ABLUECAT!!”的set命令。</p>
<h4 id="随机测试"><a href="#随机测试" class="headerlink" title="随机测试"></a>随机测试</h4><p>默认情况下测试之使用单一的Key对象，当想模拟随机的为不同Key写入时，就可以采用随机参数-r配合-t set来实现。<br><code>redis-benchmark -t set 10000 -n 1000000 -q</code><br>为了避免测试带来的数据堆积问题，可以使用<code>redis-cli flushall</code>对当前数据库做数据清理工作。</p>
<h4 id="管道批处理方式测试"><a href="#管道批处理方式测试" class="headerlink" title="管道批处理方式测试"></a>管道批处理方式测试</h4><p>默认测试过程时非管道的。<br><code>redis-benchmark -n 1000000 -t set,get -P 1000 -q</code></p>
<h3 id="测试考虑要点"><a href="#测试考虑要点" class="headerlink" title="测试考虑要点"></a>测试考虑要点</h3><h4 id="满负荷测试Redis数据库在内存中最多可以加载的数据量"><a href="#满负荷测试Redis数据库在内存中最多可以加载的数据量" class="headerlink" title="满负荷测试Redis数据库在内存中最多可以加载的数据量"></a>满负荷测试Redis数据库在内存中最多可以加载的数据量</h4><p>测试步骤：<br>①使用<code>flushall</code>命令清空测试数据库；<br>②启动持久化方式；<br>③估计现有服务器内存可以用空间；<br>④利用Redis-benchmark持续王Redis数据库插入数据；</p>
<h4 id="测试高并发、高吞吐量情况下网络通信情况"><a href="#测试高并发、高吞吐量情况下网络通信情况" class="headerlink" title="测试高并发、高吞吐量情况下网络通信情况"></a>测试高并发、高吞吐量情况下网络通信情况</h4><p>①使用Ping命令测试Redis服务器与客户端之间的延迟情况；<br>②使用Redis-benchmark工具，通过对-n,-c,-d,-P参数的调整，持续观察加大读写量的情况下，网络流量及延迟；</p>
<h4 id="其他测试重点"><a href="#其他测试重点" class="headerlink" title="其他测试重点"></a>其他测试重点</h4><p>①测试大数据块读写访问情况下Redis数据库响应情况；<br>②测试Redis服务器最大客户端连接数，可以通过持续调高-c参数来测试；<br>③测试大数据内存占用情况，频繁改写数据带来的内存下降问题。<br>注意：Redis是单线程运行模式，更适合大缓存快速CPU，而不是多核CPU；<br>注意：VM环境下Redis会变慢；<br>注意：Redis鼓励多用Pipeline；</p>
<h1 id="监控工具"><a href="#监控工具" class="headerlink" title="监控工具"></a>监控工具</h1><h2 id="MongoDB监控工具及问题"><a href="#MongoDB监控工具及问题" class="headerlink" title="MongoDB监控工具及问题"></a>MongoDB监控工具及问题</h2><h3 id="MongoDB监控工具"><a href="#MongoDB监控工具" class="headerlink" title="MongoDB监控工具"></a>MongoDB监控工具</h3><p>分为三大类：<br>第一，采用日志方式记录MongoDB运行状态；可以使用专用的日志读取工具，Mtool，在日志内容过滤基础上分析各种问题；<br>第二，MongoDB自带的各种统计工具和命令：<br>自带统计工具：Mongostat(统计数据库系统运行状态)、Mongotop(统计数据库和集合运行状态)；<br>自带统计命令：serverStatus()、currentOp、dbStats、collStats、replSetGetStatus；<br>第三，各种专业监控工具；</p>
<h3 id="MongoDB主要监控问题"><a href="#MongoDB主要监控问题" class="headerlink" title="MongoDB主要监控问题"></a>MongoDB主要监控问题</h3><h4 id="监控内存使用情况"><a href="#监控内存使用情况" class="headerlink" title="监控内存使用情况"></a>监控内存使用情况</h4><p>MongoDB内存使用建议：<br>①MongoDB在一台服务器上，一次性高并发插入数据可大10万条/秒，进行测试，观察内存使用情况；<br>②MongoDB分配内存最好：可用内存&gt;索引+加载到内存的数据+连接占用内存；<br>③生产环境下，服务器内存配置应该尽可能大；</p>
<h4 id="追踪内存使用情况"><a href="#追踪内存使用情况" class="headerlink" title="追踪内存使用情况"></a>追踪内存使用情况</h4><p>Linux的top命令，监控服务器内存使用情况；<br>MongoDB的<code>db.serverStatus().mem</code>查看内存、<code>db.stats()</code>查看索引情况；<br>使用Ops Manager、Cloud Insight等专业工具查看；<br>使用Mongostat查看内存使用出错记录；</p>
<h4 id="跟踪缺页终端情况"><a href="#跟踪缺页终端情况" class="headerlink" title="跟踪缺页终端情况"></a>跟踪缺页终端情况</h4><p>使用<code>db.serverStatus()</code>命令，查看page_faults(缺页中断次数)，若其明显增加，则考虑内存不足的问题。也可以使用Ops Manager、Cloud Insight监控；</p>
<h4 id="跟踪索引树脱靶情况"><a href="#跟踪索引树脱靶情况" class="headerlink" title="跟踪索引树脱靶情况"></a>跟踪索引树脱靶情况</h4><p>索引树不在内存中，去二次缺页中断读取索引树叫索引树脱靶。可以使用Mongostat、Ops Manager、Cloud Insight等工具监控，也可以使用explain()命令分析指定查询的索引使用情况。</p>
<h4 id="监控CPU使用情况"><a href="#监控CPU使用情况" class="headerlink" title="监控CPU使用情况"></a>监控CPU使用情况</h4><p>MongoDB使用CPU主要用于读写(I/O)处理上。监控CPU的工具可以是：Ops Manager、Cloud Insight、 Mongostat或linux下的top命令。</p>
<h4 id="监控磁盘使用情况"><a href="#监控磁盘使用情况" class="headerlink" title="监控磁盘使用情况"></a>监控磁盘使用情况</h4><p>采用的方式和上类似，只有linux下使用iostat命令不同于top。</p>
<h4 id="监控副本集运行情况"><a href="#监控副本集运行情况" class="headerlink" title="监控副本集运行情况"></a>监控副本集运行情况</h4><p>MongoDB运行于副本集模式下时，需要对副本集延迟和Oplog长度等情况跟踪。可以使用的工具时<code>rs.status()</code>命令、Mongostat、Cloud manager、Ops Manager等。</p>
<h4 id="检查连接问题"><a href="#检查连接问题" class="headerlink" title="检查连接问题"></a>检查连接问题</h4><p>检查客户端连接过多，可以使用Mongostat、Ops Manager、Mtools等。</p>
<h2 id="Mongostat"><a href="#Mongostat" class="headerlink" title="Mongostat"></a>Mongostat</h2><p>Mongostat是官方免费提供的监控工具，在安装MongoDB时附带安装。</p>
<h3 id="Mongostat工具使用参数"><a href="#Mongostat工具使用参数" class="headerlink" title="Mongostat工具使用参数"></a>Mongostat工具使用参数</h3><p>–help、–verbose(-v)增加标准输出或日志文件中返回的内部报告的详细程度，-vvvv比-v详细；<br><code>--host &lt;hostname&gt;&lt;:port&gt; (-h &lt;hostname&gt;&lt;:port&gt;)</code>、–ssl、<code>--sslCAFile &lt;filename&gt;</code>指定TLS/SSL协议根证书链的.pem文件名；<br><code>--username &lt;username&gt; (-u &lt;username&gt;)</code>、<code>--password &lt;password&gt; (-p &lt;password&gt;)</code><br><code>--authenticationDatabase &lt;dbname&gt;</code>、<code>--authenticationMechanism &lt;name&gt;</code>,对安全认证机制的支持，包括SCRAM-SHA-1(默认值)、MONGODB-CR、MONGODB-X509、GSSAPI、PLAIN。<br><code>--humanReadable boolean</code>对工具统计结果输出结果进行格式化，方便阅读，True为默认值；<br><code>-o &lt;field list&gt;</code>,指定需要输出的字段、–noheaders，输出统计结果时，不显示列名(或字段)；<br><code>--rowcount &lt;number&gt;(-n &lt;number&gt;)</code>,控制输出的行数；<code>discover</code>对副本集或分片集群的所有成员进行运行状态统计；–all返回所有字段；<br>–json，以JSON格式返回该命令的输出；<br><code>&lt;sleeptime&gt;</code>该参数时Mongostat的最后一个参数，设置等待呼叫之间的时间长度，单位秒；？？？？</p>
<h3 id="Mongostat工具返回字段"><a href="#Mongostat工具返回字段" class="headerlink" title="Mongostat工具返回字段"></a>Mongostat工具返回字段</h3><p>返回的各个字段解释：<br><a href="http://blog.51cto.com/yucanghai/1705155" target="_blank" rel="noopener">返回字段值</a></p>
<h3 id="Mongostat工具使用实例"><a href="#Mongostat工具使用实例" class="headerlink" title="Mongostat工具使用实例"></a>Mongostat工具使用实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongostat -n 20 1</span><br><span class="line">	//以每秒20行的速度统计并显示结果</span><br></pre></td></tr></table></figure>
<h2 id="Mongotop"><a href="#Mongotop" class="headerlink" title="Mongotop"></a>Mongotop</h2><p>Mongotop工具也是MongoDB安装包里免费提供的一款数据库监控工具，提供对MongoDB数据库和集合的读写操作的统计信息，默认情况下每秒返回一次统计值。</p>
<h3 id="Mongotop参数"><a href="#Mongotop参数" class="headerlink" title="Mongotop参数"></a>Mongotop参数</h3><p>–help、–verbose、–quiet，以后台模式运行Mongotop，尝试限制输出量，限制内容包括从数据库命令输出、复制活动、客户端接受连接关闭连接；<br><code>--username &lt;username&gt;(-u &lt;username&gt;)</code>、<code>--password &lt;password&gt;(-p &lt;password&gt;)</code>、<code>--authenticationDatabase &lt;dbname&gt;</code>;<br><code>--locks</code>切换MOngotop的模式以报告每个数据库所的实用情况，这些数据可用于测量并发操作和锁定百分比；<br><code>--rowcount int (-n int)</code>、<code>--json</code>以JSON格式返回Mongotop统计结果的输出；<code>&lt;sleeptime&gt;</code>;</p>
<h3 id="Mongotop返回字段"><a href="#Mongotop返回字段" class="headerlink" title="Mongotop返回字段"></a>Mongotop返回字段</h3><p>ns：数据库名称空间，使用–locks参数，则ns字段不会显示在该命令的输出结果上；<br>db：数据库名称，只有使用–locks参数后，该字段才显示；<br>total：当前Mongod在指定命名空间上运行的总时间；<br>read：执行读操作的时间；<br>write：执行写入操作的时间；<br><code>&lt;timestamp&gt;</code>，提供返回数据时间；</p>
<h3 id="Mongotop使用实例"><a href="#Mongotop使用实例" class="headerlink" title="Mongotop使用实例"></a>Mongotop使用实例</h3><p><code>mongotop 10</code><br>10秒一次的频率统计数据库集合的total、read、write操作时间。</p>
<h2 id="Mtools"><a href="#Mtools" class="headerlink" title="Mtools"></a>Mtools</h2><p>Mtools是一款实用的日志分析工具包，是用python开发的。</p>
<h3 id="Mtools工具包下载并安装"><a href="#Mtools工具包下载并安装" class="headerlink" title="Mtools工具包下载并安装"></a>Mtools工具包下载并安装</h3><p>Mtools工具包的功能组成：<br>①Mlogfilter，MongoDB日志过滤器，按日期切片日志文件、合并日志文件、过滤慢查询、查找表扫描、缩短日志行、其他属性过滤，并转换为JSON格式；<br>②Mloginfo，返回关于日志文件的信息，如开始和结束时间、版本、二进制，及数据库重新启动、连接、独立视图等特殊内容；<br>③Mplotqueries，使用不同类型的图来显示日志文件统计信息(需要安装matplotlib)；<br>④Mlogvis，创建一个自定义HTML文件以web形式展现统计信息；<br>⑤Mlaunch，快速搭建本地测试环境，包括赋值集合、分片系统等(需要安装pymongo)；<br>⑥Mgenerate，基于用于测试和在在线的模板生成结构化伪随机数。</p>
<h3 id="Mtools工具包使用方法"><a href="#Mtools工具包使用方法" class="headerlink" title="Mtools工具包使用方法"></a>Mtools工具包使用方法</h3><p><a href="https://www.cnblogs.com/littleatp/p/9114471.html" target="_blank" rel="noopener">参考地址</a></p>
<h4 id="使用Mlogfilter"><a href="#使用Mlogfilter" class="headerlink" title="使用Mlogfilter"></a>使用Mlogfilter</h4><p>Mlogfilter的实用格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Mlogfilter [-h] [--version] [logifle] [logfile ...]</span><br><span class="line">		[--verbose] [--shorten [LENGTH]]</span><br><span class="line">		[--human] [--execlude] [--json]</span><br><span class="line">		[--timestamp-format &#123;ctime-pre2.4, ctime, iso8601-utc, iso8601-local&#125;]</span><br><span class="line">		[--markers MARKERS [MARKERS ...]] [--timezone N [N ...]]</span><br><span class="line">		[--namespace NS] [--operation OP] [--thread THREAD]</span><br><span class="line">		[--slow [SLOW]] [--fast [FAST]] [--scan]</span><br><span class="line">		[--word WORD [WORD ...]]</span><br><span class="line">		[--from FROM [FROM ...]] [--to TO [TO ...]]</span><br></pre></td></tr></table></figure></p>
<p>①–shorten [LENGTH]控制显示结果的行长，默认为200个字符；<br>②–human 执行结果更可读；<br>③–exclude，反转过滤；<br>④–markers MARKERS [MARKERS …]在每个合并行之前，对每部分日志内容做原始文件来源标记；<br>⑤–timezone N [N …]，时区参数，以小时为单位调整日志行的时间；<br>⑥–namespace NS，通过命名空间NS进行过滤，只返回匹配此命名空间的行；<br>⑦–operation OP;<br>⑧–thread THREAD，按线程名称过滤；<br>⑨–slow [SLOW]，返回慢命令记录；–fast [FAST]返回快命令记录；<br>⑩–scan，收集非索引查询记录；<br>⑪–word WORD [WORD …],提供一个或多个关键词对日志过滤；<br>⑫–from FROM [FROM …],通过指定时间的下限分割日志；<br>⑬–to TO [TO …]，通过指定时间的上限分割日志；<br>FROM、TO可以接受不同的时间格式[DATA]、[TIME]、[OFFSET]<br>DATA值可以是一周中的任意一天，如Mon、Tue；也可以是任意一个月，如JAN、FEB；也可以是today、now、start、end。<br>TIME值可以是小时分钟、小时分钟秒、小时分钟秒毫秒。<br>OFFSET的值可以是一下形式：s(sec); m(min); h(hours); d(days); w(weeks); mo(months); y(years);</p>
<h4 id="使用Mloginfo"><a href="#使用Mloginfo" class="headerlink" title="使用Mloginfo"></a>使用Mloginfo</h4><p>Mloginfo命令使用格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mloginfo [-h] [--version] logfile [--verbose] [--queries] [--restarts] [--distinct] [--connections] [--rsstate]</span><br></pre></td></tr></table></figure></p>
<p>①–queries，通过日志查找所有查询记录(包括更新记录)，并收集每个查询模式的统计信息。查询模式记录了查询的方式等信息(类似索引定义)。带该参数的命令显示的字段包括一下几种：<br>Namespace，命名空间，也就是查询操作的数据库名：<br>Pattern,查询语句查询模式；Count，统计各种查询的被找到次数；Min(ms)，统计查询最小执行时间；Max(ms)；Mean(ms)；Sum(ms)；<br>②–sort，配合–queries参数使用，对–queries参数方式的查询结果进行排序；<br>③–restarts，通过日志查找所有服务器重启的记录；<br>④–distinct，遍历日志文件，按照日志记录类型将所有的行进行归类统计；<br>⑤–connections，统计日志中连接和关闭连接数据库的信息，并统计客户端每个IP地址的连接和关闭次数；<br>⑥–rsstate，输出有关每个检测到的副本集状态更改的记录信息；</p>
<h4 id="使用Mplotqueries"><a href="#使用Mplotqueries" class="headerlink" title="使用Mplotqueries"></a>使用Mplotqueries</h4><p>Mplotqueries使用格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mplotqueries [-h] [--version] logfile [logfile ...]</span><br><span class="line">	[--group GROUP]</span><br><span class="line">	[--logscale]</span><br><span class="line">	[--type &#123;nscanned/n, rsstate,connchurn,durline,histogram, range, scatter, event&#125;]</span><br><span class="line">	[--overlay [&#123;add,list,reset&#125;]]</span><br><span class="line">	[additional plot type parameters]</span><br></pre></td></tr></table></figure></p>
<p>①–logscale，以对数刻画散点图显示日志统计数据。<br>②–group CROUP，按照指定数据类型对图内容进行分组统计显示。该参数分组数据类型值可以是：namespace，filename，operation，thread，log2code按最频繁的时间顺序创建范围图；pattern查询模式；custom grouping with regular expressinos；–group-limit N按照分组并限定分组最多数量，一般不超过14种；–type {nscanned/n, rsstate, connchurn, durline, histogram, range, scatter, event}指定统计图显示类型，默认为scatter(散点图)；<br>其他类型包括Histogram(直方图)、durline(持续时间线图)、connchurn(数据库连接持续图)、range(范围图)、event(事件图)、rsstate(副本集设置状态图)、nscanned/n(查询扫描图)、–overlay [{add,list,reset}]支持不同图型的叠加显示、additional plot type parameters其他附加的图绘制参数<br><strong>Mplotqueries命令使用实例(含matlotlib库安装)：</strong><br>要正常运行Mplotqueries，还需要额外安装matplotlib库，安装步骤如下：<br>第一步：下载matlotlib，注意下载的版本要和py版本一致；<br>第二步：安装matlotlib，点击安装程序(一定要在py的安装路径下)，或通过py的pip命令在线安装：<code>pip install Matplotlib</code>;<br>第三步：正常使用Mplotqueries执行实例：<br><code>mplotqueries mongoDb.log -logscale</code>,按照对数可读显示<br><code>mplotqueries mongoDb.log --group operation</code>,按照操作命令分类显示；<br><code>mplotqueries mongoDb.log --operation update</code>,按照操作命令分类显示；</p>
<h2 id="Cloudinsight"><a href="#Cloudinsight" class="headerlink" title="Cloudinsight"></a>Cloudinsight</h2><p>Cloudinsight是一款可视化系统监视工具，能够对数据指标进行聚合、分组、过滤、管理、计算，提供团队协作功能，共同管理数据和报警事件。支持监控服务器的磁盘、网络流量、I/O读写、内存、CPU使用情况等数据，探针安装完成即完成监控，其功能分监控平台本身和探针两个部分。监控平台用于收集和分析监控信息，探针用于采集所在服务器的数据并把数据传给监控平台。<br>其支持多种系统，支持多种数据库。<br>Cloudinsight Agent包括以下几个部分：<br>①采集平台和平台服务的性能指标；<br>②记录平台和平台服务的事件；<br>③生效平台和平台服务的Agent配置；<br>④向Cloudinsight发送数据。</p>
<h2 id="Redis监控工具"><a href="#Redis监控工具" class="headerlink" title="Redis监控工具"></a>Redis监控工具</h2><p>Redis性能监控工具，也分自带命令或工具、专业第三方测试工具。</p>
<h3 id="Redis的自带监控命令"><a href="#Redis的自带监控命令" class="headerlink" title="Redis的自带监控命令"></a>Redis的自带监控命令</h3><p>①list，获得客户端连接信息及数量列表；<br>②info，返回Redis服务器的各种信息和统计数值；可以用Linux命令watch加客户端info命令方式实时监控所需要的Redis信息：<br><code>watch -n 1 -d &quot;src/redis-cli -h 127.0.0.1 info | grep -e &quot;connected_clients&quot;</code><br>-n 1指每秒监控一次：“|”为管道，只获取-e指定的需要信息。<br>③monitor，持续返回服务器端的每一个命令信息；</p>
<h3 id="自带工具Sentinel-哨兵"><a href="#自带工具Sentinel-哨兵" class="headerlink" title="自带工具Sentinel(哨兵)"></a>自带工具Sentinel(哨兵)</h3><h3 id="第三方测试工具"><a href="#第三方测试工具" class="headerlink" title="第三方测试工具"></a>第三方测试工具</h3><p>Redis Live、Redis-monitor、Redis-stat、Redis Faina、Redis-sampler、Redis-audit、Redis-rdb-tools等。前四种是图形化性能监控工具，后三种是Redis数据存储情况分析工具。</p>
<h2 id="Redislive"><a href="#Redislive" class="headerlink" title="Redislive"></a>Redislive</h2><p>Redis Live是一个仪表盘应用程序，其中包括许多小部件。它的核心是一个监视脚本，定期想Redis实例发送INFO和MONITOR命令，并存储用于分析的数据。</p>
<h3 id="下载和安装"><a href="#下载和安装" class="headerlink" title="下载和安装"></a>下载和安装</h3><h4 id="安装依赖环境"><a href="#安装依赖环境" class="headerlink" title="安装依赖环境"></a>安装依赖环境</h4><p>需要安装Python、Tornado、Redis.py、Python-dateutil。</p>
<h4 id="安装Redis-Live"><a href="#安装Redis-Live" class="headerlink" title="安装Redis Live"></a>安装Redis Live</h4><p>安装Redis Live后需呀修改其配置文件redis-live.conf。<br>使用Redis Live脚本：<br><code>redis-monitor.py --duration=120</code><br>开启Redis Live的web服务：<br><code>redis-live.py</code><br>在浏览器上打开Redis Live网站地址<a href="http://localhost:8888/index.html" target="_blank" rel="noopener">http://localhost:8888/index.html</a></p>
<h3 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h3><p>在实际生成中慎重使用Redis Live的Monitor。<br>Redis-stat工具，抛弃了Monitor命令，只用info命令来实现监控信息采集。<br>Redis-monitor是国内改造开发的代替Redis Live工具，去掉了对Google在线访问的限制要求。</p>
<h2 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h2><p>Redis分布式部署下，可以使用自带的复制监控工具Sentinel来实现对主节点和从节点的运行监控。当Sentinel发现主节点故障，则启动故障转移功能，用一个从节点蒂安提出现故障的主节点；同时通过API向管理员或其他应用程序发送通知。</p>
<h3 id="使用Sentinel"><a href="#使用Sentinel" class="headerlink" title="使用Sentinel"></a>使用Sentinel</h3><p>①首先需要配置sentinel.conf文件；<br>②用redis-sentinel可执行程序启动监控:<code>redis-sentinel /path/to/sentinel.conf</code><br>③也可以通过重新启动带sentinel参数的Redis数据库服务来气筒监控：<code>redis-server /path/to/sentinel.conf --sentinel</code></p>
<h3 id="Sentinel使用建议"><a href="#Sentinel使用建议" class="headerlink" title="Sentinel使用建议"></a>Sentinel使用建议</h3><p><a href="https://redis.io/topics/sentinel" target="_blank" rel="noopener">Sentinel详细使用原理</a><br>在实际生成环境下使用时，必须考虑使用它所带来的额外流量开销。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://banyibu.com/2019/01/11/NoSQL第十三章-NoSQL的实用辅助工具/" data-id="cjqs0vffx0032ncv7h6vlpwok" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NoSQL/">NoSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/01/11/NoSQL第十二章-NoSQL选择及部署/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">NoSQL第十二章-NoSQL选择及部署</div>
    </a>
  
</nav>

  
</article>






  <div id="comments" class="comments">
  	<div id="uyan_frame"></div>
  </div>
	<section class="livere" id="comments">
<!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzc5NS8xNDMyNg==">
<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
</script>
<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->
</section>
	


</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">致良知，事上练</h1>
    <h2 class="blog-subtitle">偏爱精神世界的更新换代，日日思之，日日求突破。</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
          <a href="/about" title="About">
            <li>关于</li>
          </a>
        
          <a href="/sponsor" title="Sponsor">
            <li>投喂</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://upload-images.jianshu.io/upload_images/12985001-ffd8bc90edb9f3e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    <h2 class="author">般一不</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>59</strong><br>文章</div></a>
      <a href="/categories"><div><strong>27</strong><br>分类</div></a>
      <a href="/tags"><div><strong>27</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/banyibu" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="https://dadavision.cn" target="_blank" title="Dadavision">
          Dadavision
        </a>
      
        <a class="hvr-bounce-in" href="https://www.resultlv.com" target="_blank" title="Rwsultlv">
          Rwsultlv
        </a>
      
    </div>
  </div>
</div>



  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2018 - 2019 般一不<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Ban Yibu</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">首页</a>
          
            <a href="/tags" title="" class="menuItem">标签</a>
          
            <a href="/categories" title="" class="menuItem">分类</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
            <a href="/about" title="" class="menuItem">关于</a>
          
            <a href="/sponsor" title="" class="menuItem">打赏</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>